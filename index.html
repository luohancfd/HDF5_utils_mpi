<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HDF5 utilities: HDF5_utils</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HDF5 utilities
   </div>
   <div id="projectbrief">my own Fortran high level interface for HDF5</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">HDF5_utils </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This library is to provide a high level interface into <a href="https://portal.hdfgroup.org/display/support">HDF5</a>. This is, of course, based off HDF5's own High-Level module (<a href="https://support.hdfgroup.org/HDF5/doc/HL/RM_H5LT.html">HDLT</a>) but customized to my own needs.</p>
<p>The aim of this library is to:</p><ul>
<li>Abstract most of the HDF5 tyes.</li>
<li>Read/write datasets of multiple types and ranks.<ul>
<li>Assumed reading/writing full arrays.</li>
<li>Remove need to pass dimensions (allocation and consistency of dimensions is left to the user).</li>
</ul>
</li>
<li>Write/read attributes to file/group/datasets.</li>
<li>Provide the ability to create groups, and access datasets by either absolute or relative path.</li>
<li>Some auxiliary functions:<ul>
<li>Check if dataset/object exists.</li>
<li>Get rank and size of dataset, either to check dimensions or to allocate array before reading.</li>
</ul>
</li>
</ul>
<h1>Module summary</h1>
<p>This is just a short summary to provide a basic understandig of the module. For a more detailed explaination, look at the code comments. If you have doxygen installed, <code>make docs</code> will produce an html output in <code>docs/html/index.html</code>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">subroutine </th><th class="markdownTableHeadLeft">inputs </th><th class="markdownTableHeadLeft">description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>hdf_open_file</code> </td><td class="markdownTableBodyLeft"><code>file_id</code>, <code>filename</code>, <code>STATUS</code>, <code>ACTION</code> </td><td class="markdownTableBodyLeft">Opens file and return identifier  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>hdf_close_file</code> </td><td class="markdownTableBodyLeft"><code>file_id</code> </td><td class="markdownTableBodyLeft">Closes a hdf5 file  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>hdf_write_dataset</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>dset_name</code>, <code>data</code> </td><td class="markdownTableBodyLeft">write out array (or scalar)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>hdf_read_dataset</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>dset_name</code>, <code>data</code> </td><td class="markdownTableBodyLeft">read in array (or scalar)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>hdf_create_dataset</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>dset_name</code>, <code>dset_dims</code>, <code>dset_type</code> </td><td class="markdownTableBodyLeft">creates an empty dataset  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>hdf_write_vector_to_dataset</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>dset_name</code>, <code>offset</code>, <code>vector</code> </td><td class="markdownTableBodyLeft">write a vector to leading edge of dataset  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>hdf_read_vector_from_dataset</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>dset_name</code>, <code>offset</code>, <code>vector</code> </td><td class="markdownTableBodyLeft">read a 1d array from from leading edge of dataset  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>hdf_write_attribute</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>obj_name</code>, <code>attr_name</code>, <code>data</code> </td><td class="markdownTableBodyLeft">write out attribute array (or scalar)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>hdf_read_attribute</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>obj_name</code>, <code>attr_name</code>, <code>data</code> </td><td class="markdownTableBodyLeft">read in attribute array (or scalar)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>hdf_create_group</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>group_name</code> </td><td class="markdownTableBodyLeft">Create a new group  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>hdf_open_group</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>group_name</code>, <code>group_id</code> </td><td class="markdownTableBodyLeft">Opens a group and returns the identifier  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>hdf_close_group</code> </td><td class="markdownTableBodyLeft"><code>group_id</code> </td><td class="markdownTableBodyLeft">Close a group by identifier  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>hdf_get_rank</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>dset_name</code>, <code>rank</code> </td><td class="markdownTableBodyLeft">Get the rank of a dataset  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>hdf_get_dims</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>dset_name</code>, <code>dims</code> </td><td class="markdownTableBodyLeft">get the dimensions of a dataset  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>hdf_exists</code> </td><td class="markdownTableBodyLeft"><code>loc_id</code>, <code>obj_name</code> </td><td class="markdownTableBodyLeft">Check if location exists  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>hdf_set_print_messages</code> </td><td class="markdownTableBodyLeft"><code>val_print_messages</code> </td><td class="markdownTableBodyLeft">Sets the value of <code>hdf_print_messages</code>  </td></tr>
</table>
<h1>Examples</h1>
<h2>The Basics</h2>
<p>Here is a simple example of writing to a new HDF5 file:</p>
<div class="fragment"><div class="line"><span class="keywordtype">use </span>hdf5_utils</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">integer(HID_T)</span> :: file_id</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">integer</span> :: ii, jj, kk, ll</div>
<div class="line"><span class="keywordtype">integer</span> :: data0, data1(8), data2(4,6), data3(4,6,8), data4(4,6,8,10)</div>
<div class="line"><span class="keywordtype">real</span>(sp) :: data2_sp(4,6)</div>
<div class="line"><span class="keywordtype">real</span>(dp) :: data2_dp(4,6)</div>
<div class="line"> </div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="keyword">call </span>hdf_set_print_messages(.true.)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! open file</span></div>
<div class="line"><span class="keyword">call </span>hdf_open_file(file_id, <span class="stringliteral">&quot;test_hl.h5&quot;</span>, status=<span class="stringliteral">&#39;NEW&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! write out some datasets</span></div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data0&quot;</span>, data0)</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data1&quot;</span>, data1)</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data2&quot;</span>, data2)</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data3&quot;</span>, data3)</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data4&quot;</span>, data4)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data2_sp&quot;</span>, data2_sp)</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data2_dp&quot;</span>, data2_dp)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! close file</span></div>
<div class="line"><span class="keyword">call </span>hdf_close_file(file_id)</div>
</div><!-- fragment --><p>The rank, dimension, and datatypes of the datasets in the HDF5 file correspond to the arrays passed to it.</p>
<p>Here is a simple examle of reading from an HDF5 file:</p>
<div class="fragment"><div class="line"><span class="keywordtype">use </span>hdf5_utils</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">integer(HID_T)</span> :: file_id</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">integer</span> :: data0, data1(8), data2(4,6), data3(4,6,8), data4(4,6,8,10)</div>
<div class="line"><span class="keywordtype">real</span>(sp) :: data2_sp(4,6)</div>
<div class="line"><span class="keywordtype">real</span>(dp) :: data2_dp(4,6)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! open file</span></div>
<div class="line"><span class="keyword">call </span>hdf_open_file(file_id, <span class="stringliteral">&quot;test_hl.h5&quot;</span>, status=<span class="stringliteral">&#39;OLD&#39;</span>, action=<span class="stringliteral">&#39;READ&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! read in some datasets</span></div>
<div class="line"><span class="keyword">call </span>hdf_read_dataset(file_id, <span class="stringliteral">&quot;data0&quot;</span>, data0)</div>
<div class="line"><span class="keyword">call </span>hdf_read_dataset(file_id, <span class="stringliteral">&quot;data1&quot;</span>, data1)</div>
<div class="line"><span class="keyword">call </span>hdf_read_dataset(file_id, <span class="stringliteral">&quot;data2&quot;</span>, data2)</div>
<div class="line"><span class="keyword">call </span>hdf_read_dataset(file_id, <span class="stringliteral">&quot;data3&quot;</span>, data3)</div>
<div class="line"><span class="keyword">call </span>hdf_read_dataset(file_id, <span class="stringliteral">&quot;data4&quot;</span>, data4)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">call </span>hdf_read_dataset(file_id, <span class="stringliteral">&quot;data2_sp&quot;</span>, data2_sp)</div>
<div class="line"><span class="keyword">call </span>hdf_read_dataset(file_id, <span class="stringliteral">&quot;data2_dp&quot;</span>, data2_dp)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! close file</span></div>
<div class="line"><span class="keyword">call </span>hdf_close_file(file_id)</div>
</div><!-- fragment --><p>The rank, dimension, and datatypes array should match that of the datasets in the HDF5 file, otherwise the HDF5 library will bring up and error.</p>
<h2>Converting datatypes</h2>
<p>Note that HDF5 will convert the datatype on reading. So based on the above example </p><div class="fragment"><div class="line"><span class="keywordtype">use </span>hdf5_utils</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">integer(HID_T)</span> :: file_id</div>
<div class="line"><span class="keywordtype">integer</span> :: ii</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">integer</span> :: data2(4,6)</div>
<div class="line"><span class="keywordtype">real</span>(sp) :: data2_sp(4,6)</div>
<div class="line"><span class="keywordtype">real</span>(dp) :: data2_dp(4,6)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! open file</span></div>
<div class="line"><span class="keyword">call </span>hdf_open_file(file_id, <span class="stringliteral">&quot;test_hl.h5&quot;</span>, status=<span class="stringliteral">&#39;OLD&#39;</span>, action=<span class="stringliteral">&#39;READ&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! read in some datasets</span></div>
<div class="line"><span class="keyword">call </span>hdf_read_dataset(file_id, <span class="stringliteral">&quot;data2_dp&quot;</span>, data2)</div>
<div class="line"><span class="keyword">call </span>hdf_read_dataset(file_id, <span class="stringliteral">&quot;data2_dp&quot;</span>, data2_sp)</div>
<div class="line"><span class="keyword">call </span>hdf_read_dataset(file_id, <span class="stringliteral">&quot;data2_dp&quot;</span>, data2_dp)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">do</span> ii = 1,4</div>
<div class="line">  <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(10(I5,3x))&#39;</span>) data2(ii,:)</div>
<div class="line"><span class="keywordflow">enddo</span></div>
<div class="line"><span class="keywordflow">do</span> ii = 1,4</div>
<div class="line">  <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(10(F7.1,1x))&#39;</span>) data2_sp(ii,:)</div>
<div class="line"><span class="keywordflow">enddo</span></div>
<div class="line"><span class="keywordflow">do</span> ii = 1,4</div>
<div class="line">  <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(10F8.2)&#39;</span>) data2_dp(ii,:)</div>
<div class="line"><span class="keywordflow">enddo</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">! close file</span></div>
<div class="line"><span class="keyword">call </span>hdf_close_file(file_id)</div>
</div><!-- fragment --><p>This example will read in from a double precision dataset into an integer, real, and double precision array. Note that the integer array will be the floor of the double/real array.</p>
<p>For writing, just convert the data array before writing using the built in int &amp; real functions</p>
<h2>Chunking and compression</h2>
<p>An advanced and very useful feature of the HDF5 library is <a href="https://portal.hdfgroup.org/display/HDF5/Compressed+Datasets">chunking and compression</a>. I have implemented a subset of this that I think is enough for my needs. When writing the dataset, just pass the optional filter parameter (options are 'none', 'szip', 'gzip', and 'gzip+shuffle'). Also, optionally there is the chucks parameter, which defined the size of data chunks in the dataset. A great thing is, like converting datatypes, when reading no additional care needs to be taken because the HDF5 library will sort it out for you (see note below):</p>
<div class="fragment"><div class="line"><span class="keywordtype">use </span>hdf5_utils</div>
<div class="line"> </div>
<div class="line"><span class="comment">! open file</span></div>
<div class="line"><span class="keyword">call </span>hdf_open_file(file_id, <span class="stringliteral">&quot;test_hl_special.h5&quot;</span>, status=<span class="stringliteral">&#39;NEW&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! write out some datasets</span></div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data0&quot;</span>, data0)</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data1&quot;</span>, data1, filter=<span class="stringliteral">&#39;szip&#39;</span>)</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data2&quot;</span>, data2, filter=<span class="stringliteral">&#39;gzip+shuffle&#39;</span>)</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data3&quot;</span>, data3, filter=<span class="stringliteral">&#39;gzip+shuffle&#39;</span>, chunks=(/4,6,1/))</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data4&quot;</span>, data4, chunks=(/2,3,4,2/))</div>
<div class="line"> </div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data2_sp&quot;</span>, data2_sp, filter=<span class="stringliteral">&#39;gzip+shuffle&#39;</span>)</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;data2_dp&quot;</span>, data2_dp, filter=<span class="stringliteral">&#39;gzip+shuffle&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! close file</span></div>
<div class="line"><span class="keyword">call </span>hdf_close_file(file_id)</div>
</div><!-- fragment --><p>Note: that the efficiency of the compression and the writing/reading speed depend heavily on you data and you use cases. For instance, one of my uses is to write out 3D GCM data, and then read in select vertical profiles for an interpolation. When I chunk by vertical profile (1,1,103), the compression was very inefficient. When I chunk by horizontal slab (90,45,1), the compression is the about same as if I just chunk the whole set together. So I have to determine for myself the tradoff between storage and speed. (In my case I chunk by horizontal slab so that each chunk is below the 1MB cache size, and read in a whole dataset and do multiple interpolations, until moving onto the next dataset).</p>
<h2>Using Attributes</h2>
<p>Attribute are just like data sets, but they can be attached to datasets, group, or the file root. The suggested use is for small items like the code version or run parameters:</p>
<div class="fragment"><div class="line"><span class="keywordtype">use </span>hdf5_utils</div>
<div class="line"> </div>
<div class="line"><span class="comment">! open file</span></div>
<div class="line"><span class="keyword">call </span>hdf_open_file(file_id, <span class="stringliteral">&quot;test_hl.h5&quot;</span>, status=<span class="stringliteral">&#39;OLD&#39;</span>, action=<span class="stringliteral">&#39;READWRITE&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! write attribute to a dataset</span></div>
<div class="line"><span class="keyword">call </span>hdf_write_attribute(file_id, <span class="stringliteral">&quot;data1&quot;</span>, <span class="stringliteral">&quot;rank&quot;</span>, 7)</div>
<div class="line"><span class="keyword">call </span>hdf_write_attribute(file_id, <span class="stringliteral">&quot;data4&quot;</span>, <span class="stringliteral">&quot;luckynumber&quot;</span>, 1.618_dp)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! write attribute to the file (and get version from Makefile)</span></div>
<div class="line"><span class="keyword">call </span>date_and_time(date=date, time=time)</div>
<div class="line"><span class="keyword">call </span>hdf_write_attribute(file_id, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;date/time&quot;</span>, date // <span class="stringliteral">&quot;: &quot;</span> // time)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! close file</span></div>
<div class="line"><span class="keyword">call </span>hdf_close_file(file_id)</div>
</div><!-- fragment --><p>The rank, dimension, and datatypes of the attribute in the HDF5 file correspond to the arrays passed to it. Further, there is the <code>hdf5_utils::hdf_read_attribute</code> subroutine.</p>
<h2>Using Groups</h2>
<p>Groups are a nice way to organize datasets and attributes within the HDF5 file. They work like directories/folder on a computer. When using group, you can access their contents using absolute or relative paths.</p>
<div class="fragment"><div class="line"><span class="keywordtype">use </span>hdf5_utils</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">integer(HID_T)</span> :: file_id, group_id</div>
<div class="line"> </div>
<div class="line"><span class="comment">! open file</span></div>
<div class="line"><span class="keyword">call </span>hdf_open_file(file_id, <span class="stringliteral">&quot;outfile.h5&quot;</span>, status=<span class="stringliteral">&#39;NEW&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! absolute access</span></div>
<div class="line"><span class="keyword">call </span>hdf_create_group(file_id, <span class="stringliteral">&quot;group1&quot;</span>)</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(file_id, <span class="stringliteral">&quot;group1/data1&quot;</span>, data1)</div>
<div class="line"><span class="keyword">call </span>hdf_write_attribute(file_id, <span class="stringliteral">&quot;group1&quot;</span>, <span class="stringliteral">&quot;tag&quot;</span>, <span class="stringliteral">&quot;this is group 1&quot;</span>)</div>
<div class="line"><span class="keyword">call </span>hdf_write_attribute(file_id, <span class="stringliteral">&quot;group1/data1&quot;</span>, <span class="stringliteral">&quot;tag&quot;</span>, <span class="stringliteral">&quot;this is data1 in group 1&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! relative access</span></div>
<div class="line"><span class="keyword">call </span>hdf_create_group(file_id, <span class="stringliteral">&quot;group2&quot;</span>)</div>
<div class="line"><span class="keyword">call </span>hdf_open_group(file_id, <span class="stringliteral">&quot;group2&quot;</span>, group_id)</div>
<div class="line"><span class="keyword">call </span>hdf_write_dataset(group_id, <span class="stringliteral">&quot;data2&quot;</span>, data2)</div>
<div class="line"><span class="keyword">call </span>hdf_write_attribute(group_id, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;tag&quot;</span>, <span class="stringliteral">&quot;this is group 2&quot;</span>)</div>
<div class="line"><span class="keyword">call </span>hdf_write_attribute(group_id, <span class="stringliteral">&quot;data2&quot;</span>, <span class="stringliteral">&quot;tag&quot;</span>, <span class="stringliteral">&quot;this is data2 in group 2&quot;</span>)</div>
<div class="line"><span class="keyword">call </span>hdf_close_group(group_id)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! close file</span></div>
<div class="line"><span class="keyword">call </span>hdf_close_file(file_id)</div>
</div><!-- fragment --><p>Notice in the relative path case, we can pass the <code>group_id</code> to read/write subroutines instead of the <code>file_id</code>. This can be used for convenient access to nested objects.</p>
<h2>Unkown size</h2>
<p>There are two subroutine, <code>hdf_get_rank</code> and <code>hdf_get_dims</code>, to get the rank (tensor rank, number of dimensions) of a dataset and the dimensions of a dataset. These can be use, for example, to allocate an array before reading in the data</p>
<div class="fragment"><div class="line"><span class="keywordtype">use </span>hdf5_utils</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">integer(HID_T)</span> :: file_id</div>
<div class="line"><span class="keywordtype">integer</span> :: rank, dims(6)</div>
<div class="line"><span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: test4(:,:,:,:)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! open file</span></div>
<div class="line"><span class="keyword">call </span>hdf_open_file(file_id, <span class="stringliteral">&quot;test_hl.h5&quot;</span>, status=<span class="stringliteral">&#39;OLD&#39;</span>, action=<span class="stringliteral">&#39;READ&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! get rank</span></div>
<div class="line"><span class="keyword">call </span>hdf_get_rank(file_id, <span class="stringliteral">&quot;data4&quot;</span>, rank)</div>
<div class="line"><span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;rank(data4) = &quot;</span>, rank</div>
<div class="line"> </div>
<div class="line"><span class="comment">! get dimensions</span></div>
<div class="line"><span class="keyword">call </span>hdf_get_dims(file_id, <span class="stringliteral">&quot;data4&quot;</span>, dims)</div>
<div class="line"><span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;dims(data4) = &quot;</span>, dims(1:rank)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! allocate and read</span></div>
<div class="line"><span class="keyword">allocate</span> ( test4(dims(1), dims(2), dims(3), dims(4)) )</div>
<div class="line"><span class="keyword">call </span>hdf_read_dataset(file_id, <span class="stringliteral">&quot;data4&quot;</span>, data4)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! close file</span></div>
<div class="line"><span class="keyword">call </span>hdf_close_file(file_id)</div>
</div><!-- fragment --><h2>Writing/reading by column</h2>
<p>It is sometimes convenient to write/read only single column of a multidimensional array.</p>
<blockquote class="doxtable">
<p><b>NOTE:</b> FORTRAN is a column oriented programming language. This means that elements of each column is stored contiguously in memory, and therefore has fastest access. The HDF5 library is written in C, which is a row oriented language. Since the FORTRAN library is just a wrapper around the C library, the array written out to the HDF5 file is the transpose of the array we see in FORTRAN. So we are actually reading in a 'row' along the last dimension in the dataset in the HDF5 file as a column vector in FORTRAN. Keep this in mind if you read access this data in another language, like C or Python. </p>
</blockquote>
<p>For instance, if a 2d array is a set of data vectors that we wish to perform a long operation on, then we can read in one vector at a time and treat it before moving onto the next one.</p>
<div class="fragment"><div class="line"><span class="keywordtype">use </span>hdf5_utils</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">integer(HID_T)</span> :: file_id</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">integer</span> :: j, k</div>
<div class="line"><span class="keywordtype">real</span>(dp) :: array(4)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">write</span>(*,<span class="stringliteral">&#39;(A)&#39;</span>) <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><span class="keyword">write</span>(*,<span class="stringliteral">&#39;(A)&#39;</span>) <span class="stringliteral">&quot;Test writing out by column&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">! open file</span></div>
<div class="line"><span class="keyword">call </span>hdf_open_file(file_id, <span class="stringliteral">&quot;test_hl.h5&quot;</span>, status=<span class="stringliteral">&#39;OLD&#39;</span>, action=<span class="stringliteral">&#39;WRITE&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! create dataset</span></div>
<div class="line"><span class="keyword">call </span>hdf_create_dataset(file_id, <span class="stringliteral">&quot;vdata3&quot;</span>, (/4,6,8/), <span class="stringliteral">&quot;double&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">! loop through array</span></div>
<div class="line"><span class="keywordflow">do</span> j = 1, 6</div>
<div class="line">   <span class="keywordflow">do</span> k = 1, 8</div>
<div class="line">      array = real(j+k-1, dp)</div>
<div class="line">      <span class="keyword">call </span>hdf_write_vector_to_dataset(file_id, <span class="stringliteral">&quot;vdata3&quot;</span>, (/ j, k /), array)</div>
<div class="line"><span class="keywordflow">   end do</span></div>
<div class="line"><span class="keywordflow">end do</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">call </span>hdf_read_vector_from_dataset(file_id, <span class="stringliteral">&quot;data3&quot;</span>, (/1,1/), array)</div>
<div class="line"><span class="keyword">write</span>(*,*) array</div>
<div class="line"> </div>
<div class="line"><span class="comment">! close file</span></div>
<div class="line"><span class="keyword">call </span>hdf_close_file(file_id)</div>
</div><!-- fragment --><h1>Copyright</h1>
<p>Copyright (c) 2017-2019 Justin Erwin Copyright (c) 2020 Han Luo </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
